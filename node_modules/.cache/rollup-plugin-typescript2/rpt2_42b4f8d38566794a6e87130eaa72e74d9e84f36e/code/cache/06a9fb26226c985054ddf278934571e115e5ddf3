{"code":"/**\r\n * @license\r\n * Copyright 2020 Google LLC.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nimport { __awaiter, __generator } from \"tslib\";\r\nimport { SDK_VERSION } from '@firebase/app';\r\nimport { querystring } from '@firebase/util';\r\nimport { _assert, _createError } from '../../core/util/assert';\r\nimport { Delay } from '../../core/util/delay';\r\nimport { _emulatorUrl } from '../../core/util/emulator';\r\nimport { _window } from '../auth_window';\r\nimport * as gapiLoader from './gapi';\r\nvar PING_TIMEOUT = new Delay(5000, 15000);\r\nvar IFRAME_PATH = '__/auth/iframe';\r\nvar EMULATED_IFRAME_PATH = 'emulator/auth/iframe';\r\nvar IFRAME_ATTRIBUTES = {\r\n    style: {\r\n        position: 'absolute',\r\n        top: '-100px',\r\n        width: '1px',\r\n        height: '1px'\r\n    },\r\n    'aria-hidden': 'true',\r\n    tabindex: '-1'\r\n};\r\n// Map from apiHost to endpoint ID for passing into iframe. In current SDK, apiHost can be set to\r\n// anything (not from a list of endpoints with IDs as in legacy), so this is the closest we can get.\r\nvar EID_FROM_APIHOST = new Map([\r\n    [\"identitytoolkit.googleapis.com\" /* DefaultConfig.API_HOST */, 'p'],\r\n    ['staging-identitytoolkit.sandbox.googleapis.com', 's'],\r\n    ['test-identitytoolkit.sandbox.googleapis.com', 't'] // test\r\n]);\r\nfunction getIframeUrl(auth) {\r\n    var config = auth.config;\r\n    _assert(config.authDomain, auth, \"auth-domain-config-required\" /* AuthErrorCode.MISSING_AUTH_DOMAIN */);\r\n    var url = config.emulator\r\n        ? _emulatorUrl(config, EMULATED_IFRAME_PATH)\r\n        : \"https://\".concat(auth.config.authDomain, \"/\").concat(IFRAME_PATH);\r\n    var params = {\r\n        apiKey: config.apiKey,\r\n        appName: auth.name,\r\n        v: SDK_VERSION\r\n    };\r\n    var eid = EID_FROM_APIHOST.get(auth.config.apiHost);\r\n    if (eid) {\r\n        params.eid = eid;\r\n    }\r\n    var frameworks = auth._getFrameworks();\r\n    if (frameworks.length) {\r\n        params.fw = frameworks.join(',');\r\n    }\r\n    return \"\".concat(url, \"?\").concat(querystring(params).slice(1));\r\n}\r\nexport function _openIframe(auth) {\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        var context, gapi;\r\n        var _this = this;\r\n        return __generator(this, function (_a) {\r\n            switch (_a.label) {\r\n                case 0: return [4 /*yield*/, gapiLoader._loadGapi(auth)];\r\n                case 1:\r\n                    context = _a.sent();\r\n                    gapi = _window().gapi;\r\n                    _assert(gapi, auth, \"internal-error\" /* AuthErrorCode.INTERNAL_ERROR */);\r\n                    return [2 /*return*/, context.open({\r\n                            where: document.body,\r\n                            url: getIframeUrl(auth),\r\n                            messageHandlersFilter: gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER,\r\n                            attributes: IFRAME_ATTRIBUTES,\r\n                            dontclear: true\r\n                        }, function (iframe) {\r\n                            return new Promise(function (resolve, reject) { return __awaiter(_this, void 0, void 0, function () {\r\n                                // Clear timer and resolve pending iframe ready promise.\r\n                                function clearTimerAndResolve() {\r\n                                    _window().clearTimeout(networkErrorTimer);\r\n                                    resolve(iframe);\r\n                                }\r\n                                var networkError, networkErrorTimer;\r\n                                return __generator(this, function (_a) {\r\n                                    switch (_a.label) {\r\n                                        case 0: return [4 /*yield*/, iframe.restyle({\r\n                                                // Prevent iframe from closing on mouse out.\r\n                                                setHideOnLeave: false\r\n                                            })];\r\n                                        case 1:\r\n                                            _a.sent();\r\n                                            networkError = _createError(auth, \"network-request-failed\" /* AuthErrorCode.NETWORK_REQUEST_FAILED */);\r\n                                            networkErrorTimer = _window().setTimeout(function () {\r\n                                                reject(networkError);\r\n                                            }, PING_TIMEOUT.get());\r\n                                            // This returns an IThenable. However the reject part does not call\r\n                                            // when the iframe is not loaded.\r\n                                            iframe.ping(clearTimerAndResolve).then(clearTimerAndResolve, function () {\r\n                                                reject(networkError);\r\n                                            });\r\n                                            return [2 /*return*/];\r\n                                    }\r\n                                });\r\n                            }); });\r\n                        })];\r\n            }\r\n        });\r\n    });\r\n}\r\n//# sourceMappingURL=iframe.js.map","references":["/home/matt/Desktop/Projects/Freelance/Damon Chen/firebase-package/packages/app/dist/app/src/index.d.ts","/home/matt/Desktop/Projects/Freelance/Damon Chen/firebase-package/packages/util/dist/index.d.ts","/home/matt/Desktop/Projects/Freelance/Damon Chen/firebase-package/packages/auth/internal/index.ts","/home/matt/Desktop/Projects/Freelance/Damon Chen/firebase-package/packages/auth/src/core/errors.ts","/home/matt/Desktop/Projects/Freelance/Damon Chen/firebase-package/packages/auth/src/core/util/assert.ts","/home/matt/Desktop/Projects/Freelance/Damon Chen/firebase-package/packages/auth/src/core/util/delay.ts","/home/matt/Desktop/Projects/Freelance/Damon Chen/firebase-package/packages/auth/src/core/util/emulator.ts","/home/matt/Desktop/Projects/Freelance/Damon Chen/firebase-package/packages/auth/src/model/auth.ts","/home/matt/Desktop/Projects/Freelance/Damon Chen/firebase-package/packages/auth/src/platform_browser/auth_window.ts","/home/matt/Desktop/Projects/Freelance/Damon Chen/firebase-package/packages/auth/src/platform_browser/iframe/gapi.ts"],"map":"{\"version\":3,\"file\":\"iframe.js\",\"sourceRoot\":\"\",\"sources\":[\"../../../../../../../src/platform_browser/iframe/iframe.ts\"],\"names\":[],\"mappings\":\"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\"}","dts":{"name":"/home/matt/Desktop/Projects/Freelance/Damon Chen/firebase-package/packages/auth/node_modules/.cache/rollup-plugin-typescript2/placeholder/src/platform_browser/iframe/iframe.d.ts","writeByteOrderMark":false,"text":"/**\r\n * @license\r\n * Copyright 2020 Google LLC.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nimport { AuthInternal } from '../../model/auth';\r\nexport declare function _openIframe(auth: AuthInternal): Promise<gapi.iframes.Iframe>;\r\n"}}
