{"code":"/**\r\n * @license\r\n * Copyright 2020 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nimport { __awaiter, __generator } from \"tslib\";\r\nimport { debugAssert, _fail } from '../util/assert';\r\nimport { _link, _reauth, _signIn } from '../strategies/idp';\r\n/**\r\n * Popup event manager. Handles the popup's entire lifecycle; listens to auth\r\n * events\r\n */\r\nvar AbstractPopupRedirectOperation = /** @class */ (function () {\r\n    function AbstractPopupRedirectOperation(auth, filter, resolver, user, bypassAuthState) {\r\n        if (bypassAuthState === void 0) { bypassAuthState = false; }\r\n        this.auth = auth;\r\n        this.resolver = resolver;\r\n        this.user = user;\r\n        this.bypassAuthState = bypassAuthState;\r\n        this.pendingPromise = null;\r\n        this.eventManager = null;\r\n        this.filter = Array.isArray(filter) ? filter : [filter];\r\n    }\r\n    AbstractPopupRedirectOperation.prototype.execute = function () {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) { return __awaiter(_this, void 0, void 0, function () {\r\n            var _a, e_1;\r\n            return __generator(this, function (_b) {\r\n                switch (_b.label) {\r\n                    case 0:\r\n                        this.pendingPromise = { resolve: resolve, reject: reject };\r\n                        _b.label = 1;\r\n                    case 1:\r\n                        _b.trys.push([1, 4, , 5]);\r\n                        _a = this;\r\n                        return [4 /*yield*/, this.resolver._initialize(this.auth)];\r\n                    case 2:\r\n                        _a.eventManager = _b.sent();\r\n                        return [4 /*yield*/, this.onExecution()];\r\n                    case 3:\r\n                        _b.sent();\r\n                        this.eventManager.registerConsumer(this);\r\n                        return [3 /*break*/, 5];\r\n                    case 4:\r\n                        e_1 = _b.sent();\r\n                        this.reject(e_1);\r\n                        return [3 /*break*/, 5];\r\n                    case 5: return [2 /*return*/];\r\n                }\r\n            });\r\n        }); });\r\n    };\r\n    AbstractPopupRedirectOperation.prototype.onAuthEvent = function (event) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var urlResponse, sessionId, postBody, tenantId, error, type, params, _a, e_2;\r\n            return __generator(this, function (_b) {\r\n                switch (_b.label) {\r\n                    case 0:\r\n                        urlResponse = event.urlResponse, sessionId = event.sessionId, postBody = event.postBody, tenantId = event.tenantId, error = event.error, type = event.type;\r\n                        if (error) {\r\n                            this.reject(error);\r\n                            return [2 /*return*/];\r\n                        }\r\n                        params = {\r\n                            auth: this.auth,\r\n                            requestUri: urlResponse,\r\n                            sessionId: sessionId,\r\n                            tenantId: tenantId || undefined,\r\n                            postBody: postBody || undefined,\r\n                            user: this.user,\r\n                            bypassAuthState: this.bypassAuthState\r\n                        };\r\n                        _b.label = 1;\r\n                    case 1:\r\n                        _b.trys.push([1, 3, , 4]);\r\n                        _a = this.resolve;\r\n                        return [4 /*yield*/, this.getIdpTask(type)(params)];\r\n                    case 2:\r\n                        _a.apply(this, [_b.sent()]);\r\n                        return [3 /*break*/, 4];\r\n                    case 3:\r\n                        e_2 = _b.sent();\r\n                        this.reject(e_2);\r\n                        return [3 /*break*/, 4];\r\n                    case 4: return [2 /*return*/];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    AbstractPopupRedirectOperation.prototype.onError = function (error) {\r\n        this.reject(error);\r\n    };\r\n    AbstractPopupRedirectOperation.prototype.getIdpTask = function (type) {\r\n        switch (type) {\r\n            case \"signInViaPopup\" /* AuthEventType.SIGN_IN_VIA_POPUP */:\r\n            case \"signInViaRedirect\" /* AuthEventType.SIGN_IN_VIA_REDIRECT */:\r\n                return _signIn;\r\n            case \"linkViaPopup\" /* AuthEventType.LINK_VIA_POPUP */:\r\n            case \"linkViaRedirect\" /* AuthEventType.LINK_VIA_REDIRECT */:\r\n                return _link;\r\n            case \"reauthViaPopup\" /* AuthEventType.REAUTH_VIA_POPUP */:\r\n            case \"reauthViaRedirect\" /* AuthEventType.REAUTH_VIA_REDIRECT */:\r\n                return _reauth;\r\n            default:\r\n                _fail(this.auth, \"internal-error\" /* AuthErrorCode.INTERNAL_ERROR */);\r\n        }\r\n    };\r\n    AbstractPopupRedirectOperation.prototype.resolve = function (cred) {\r\n        debugAssert(this.pendingPromise, 'Pending promise was never set');\r\n        this.pendingPromise.resolve(cred);\r\n        this.unregisterAndCleanUp();\r\n    };\r\n    AbstractPopupRedirectOperation.prototype.reject = function (error) {\r\n        debugAssert(this.pendingPromise, 'Pending promise was never set');\r\n        this.pendingPromise.reject(error);\r\n        this.unregisterAndCleanUp();\r\n    };\r\n    AbstractPopupRedirectOperation.prototype.unregisterAndCleanUp = function () {\r\n        if (this.eventManager) {\r\n            this.eventManager.unregisterConsumer(this);\r\n        }\r\n        this.pendingPromise = null;\r\n        this.cleanUp();\r\n    };\r\n    return AbstractPopupRedirectOperation;\r\n}());\r\nexport { AbstractPopupRedirectOperation };\r\n//# sourceMappingURL=abstract_popup_redirect_operation.js.map","references":["/home/matt/Desktop/Projects/Freelance/Damon Chen/firebase-package/packages/util/dist/index.d.ts","/home/matt/Desktop/Projects/Freelance/Damon Chen/firebase-package/packages/auth/src/model/popup_redirect.ts","/home/matt/Desktop/Projects/Freelance/Damon Chen/firebase-package/packages/auth/src/model/user.ts","/home/matt/Desktop/Projects/Freelance/Damon Chen/firebase-package/packages/auth/src/core/errors.ts","/home/matt/Desktop/Projects/Freelance/Damon Chen/firebase-package/packages/auth/src/core/util/assert.ts","/home/matt/Desktop/Projects/Freelance/Damon Chen/firebase-package/packages/auth/src/core/strategies/idp.ts","/home/matt/Desktop/Projects/Freelance/Damon Chen/firebase-package/packages/auth/src/model/auth.ts"],"map":"{\"version\":3,\"file\":\"abstract_popup_redirect_operation.js\",\"sourceRoot\":\"\",\"sources\":[\"../../../../../../../src/core/strategies/abstract_popup_redirect_operation.ts\"],\"names\":[],\"mappings\":\"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\"}","dts":{"name":"/home/matt/Desktop/Projects/Freelance/Damon Chen/firebase-package/packages/auth/node_modules/.cache/rollup-plugin-typescript2/placeholder/src/core/strategies/abstract_popup_redirect_operation.d.ts","writeByteOrderMark":false,"text":"/**\r\n * @license\r\n * Copyright 2020 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nimport { FirebaseError } from '@firebase/util';\r\nimport { AuthEvent, AuthEventConsumer, AuthEventType, PopupRedirectResolverInternal } from '../../model/popup_redirect';\r\nimport { UserInternal, UserCredentialInternal } from '../../model/user';\r\nimport { AuthInternal } from '../../model/auth';\r\n/**\r\n * Popup event manager. Handles the popup's entire lifecycle; listens to auth\r\n * events\r\n */\r\nexport declare abstract class AbstractPopupRedirectOperation implements AuthEventConsumer {\r\n    protected readonly auth: AuthInternal;\r\n    protected readonly resolver: PopupRedirectResolverInternal;\r\n    protected user?: UserInternal | undefined;\r\n    protected readonly bypassAuthState: boolean;\r\n    private pendingPromise;\r\n    private eventManager;\r\n    readonly filter: AuthEventType[];\r\n    abstract eventId: string | null;\r\n    constructor(auth: AuthInternal, filter: AuthEventType | AuthEventType[], resolver: PopupRedirectResolverInternal, user?: UserInternal | undefined, bypassAuthState?: boolean);\r\n    abstract onExecution(): Promise<void>;\r\n    execute(): Promise<UserCredentialInternal | null>;\r\n    onAuthEvent(event: AuthEvent): Promise<void>;\r\n    onError(error: FirebaseError): void;\r\n    private getIdpTask;\r\n    protected resolve(cred: UserCredentialInternal | null): void;\r\n    protected reject(error: Error): void;\r\n    private unregisterAndCleanUp;\r\n    abstract cleanUp(): void;\r\n}\r\n"}}
