{"code":"/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nimport { __awaiter, __generator, __rest, __spreadArray } from \"tslib\";\r\nimport { getAccountInfo } from '../../api/account_management/account';\r\nimport { _assert } from '../util/assert';\r\nimport { _logoutIfInvalidated } from './invalidation';\r\nimport { UserMetadata } from './user_metadata';\r\nimport { getModularInstance } from '@firebase/util';\r\nexport function _reloadWithoutSaving(user) {\r\n    var _a;\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        var auth, idToken, response, coreAccount, newProviderData, providerData, oldIsAnonymous, newIsAnonymous, isAnonymous, updates;\r\n        return __generator(this, function (_b) {\r\n            switch (_b.label) {\r\n                case 0:\r\n                    auth = user.auth;\r\n                    return [4 /*yield*/, user.getIdToken()];\r\n                case 1:\r\n                    idToken = _b.sent();\r\n                    return [4 /*yield*/, _logoutIfInvalidated(user, getAccountInfo(auth, { idToken: idToken }))];\r\n                case 2:\r\n                    response = _b.sent();\r\n                    _assert(response === null || response === void 0 ? void 0 : response.users.length, auth, \"internal-error\" /* AuthErrorCode.INTERNAL_ERROR */);\r\n                    coreAccount = response.users[0];\r\n                    user._notifyReloadListener(coreAccount);\r\n                    newProviderData = ((_a = coreAccount.providerUserInfo) === null || _a === void 0 ? void 0 : _a.length)\r\n                        ? extractProviderData(coreAccount.providerUserInfo)\r\n                        : [];\r\n                    providerData = mergeProviderData(user.providerData, newProviderData);\r\n                    oldIsAnonymous = user.isAnonymous;\r\n                    newIsAnonymous = !(user.email && coreAccount.passwordHash) && !(providerData === null || providerData === void 0 ? void 0 : providerData.length);\r\n                    isAnonymous = !oldIsAnonymous ? false : newIsAnonymous;\r\n                    updates = {\r\n                        uid: coreAccount.localId,\r\n                        displayName: coreAccount.displayName || null,\r\n                        photoURL: coreAccount.photoUrl || null,\r\n                        email: coreAccount.email || null,\r\n                        emailVerified: coreAccount.emailVerified || false,\r\n                        phoneNumber: coreAccount.phoneNumber || null,\r\n                        tenantId: coreAccount.tenantId || null,\r\n                        providerData: providerData,\r\n                        metadata: new UserMetadata(coreAccount.createdAt, coreAccount.lastLoginAt),\r\n                        isAnonymous: isAnonymous\r\n                    };\r\n                    Object.assign(user, updates);\r\n                    return [2 /*return*/];\r\n            }\r\n        });\r\n    });\r\n}\r\n/**\r\n * Reloads user account data, if signed in.\r\n *\r\n * @param user - The user.\r\n *\r\n * @public\r\n */\r\nexport function reload(user) {\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        var userInternal;\r\n        return __generator(this, function (_a) {\r\n            switch (_a.label) {\r\n                case 0:\r\n                    userInternal = getModularInstance(user);\r\n                    return [4 /*yield*/, _reloadWithoutSaving(userInternal)];\r\n                case 1:\r\n                    _a.sent();\r\n                    // Even though the current user hasn't changed, update\r\n                    // current user will trigger a persistence update w/ the\r\n                    // new info.\r\n                    return [4 /*yield*/, userInternal.auth._persistUserIfCurrent(userInternal)];\r\n                case 2:\r\n                    // Even though the current user hasn't changed, update\r\n                    // current user will trigger a persistence update w/ the\r\n                    // new info.\r\n                    _a.sent();\r\n                    userInternal.auth._notifyListenersIfCurrent(userInternal);\r\n                    return [2 /*return*/];\r\n            }\r\n        });\r\n    });\r\n}\r\nfunction mergeProviderData(original, newData) {\r\n    var deduped = original.filter(function (o) { return !newData.some(function (n) { return n.providerId === o.providerId; }); });\r\n    return __spreadArray(__spreadArray([], deduped, true), newData, true);\r\n}\r\nfunction extractProviderData(providers) {\r\n    return providers.map(function (_a) {\r\n        var providerId = _a.providerId, provider = __rest(_a, [\"providerId\"]);\r\n        return {\r\n            providerId: providerId,\r\n            uid: provider.rawId || '',\r\n            displayName: provider.displayName || null,\r\n            email: provider.email || null,\r\n            phoneNumber: provider.phoneNumber || null,\r\n            photoURL: provider.photoUrl || null\r\n        };\r\n    });\r\n}\r\n//# sourceMappingURL=reload.js.map","references":["/home/matt/Desktop/Projects/Freelance/Damon Chen/firebase-package/packages/auth/src/model/public_types.ts","/home/matt/Desktop/Projects/Freelance/Damon Chen/firebase-package/packages/auth/src/api/account_management/account.ts","/home/matt/Desktop/Projects/Freelance/Damon Chen/firebase-package/packages/auth/src/model/user.ts","/home/matt/Desktop/Projects/Freelance/Damon Chen/firebase-package/packages/auth/src/core/errors.ts","/home/matt/Desktop/Projects/Freelance/Damon Chen/firebase-package/packages/auth/src/core/util/assert.ts","/home/matt/Desktop/Projects/Freelance/Damon Chen/firebase-package/packages/auth/src/core/user/invalidation.ts","/home/matt/Desktop/Projects/Freelance/Damon Chen/firebase-package/packages/auth/src/core/user/user_metadata.ts","/home/matt/Desktop/Projects/Freelance/Damon Chen/firebase-package/packages/util/dist/index.d.ts"],"map":"{\"version\":3,\"file\":\"reload.js\",\"sourceRoot\":\"\",\"sources\":[\"../../../../../../../src/core/user/reload.ts\"],\"names\":[],\"mappings\":\"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\"}","dts":{"name":"/home/matt/Desktop/Projects/Freelance/Damon Chen/firebase-package/packages/auth/node_modules/.cache/rollup-plugin-typescript2/placeholder/src/core/user/reload.d.ts","writeByteOrderMark":false,"text":"/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nimport { User } from '../../model/public_types';\r\nimport { UserInternal } from '../../model/user';\r\nexport declare function _reloadWithoutSaving(user: UserInternal): Promise<void>;\r\n/**\r\n * Reloads user account data, if signed in.\r\n *\r\n * @param user - The user.\r\n *\r\n * @public\r\n */\r\nexport declare function reload(user: User): Promise<void>;\r\n"}}
