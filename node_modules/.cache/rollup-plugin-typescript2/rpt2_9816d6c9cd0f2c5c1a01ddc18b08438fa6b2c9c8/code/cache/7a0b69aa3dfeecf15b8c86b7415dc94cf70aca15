{"code":"/**\r\n * @license\r\n * Copyright 2022 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nimport { __awaiter, __generator } from \"tslib\";\r\nvar AuthMiddlewareQueue = /** @class */ (function () {\r\n    function AuthMiddlewareQueue(auth) {\r\n        this.auth = auth;\r\n        this.queue = [];\r\n    }\r\n    AuthMiddlewareQueue.prototype.pushCallback = function (callback, onAbort) {\r\n        var _this = this;\r\n        // The callback could be sync or async. Wrap it into a\r\n        // function that is always async.\r\n        var wrappedCallback = function (user) {\r\n            return new Promise(function (resolve, reject) {\r\n                try {\r\n                    var result = callback(user);\r\n                    // Either resolve with existing promise or wrap a non-promise\r\n                    // return value into a promise.\r\n                    resolve(result);\r\n                }\r\n                catch (e) {\r\n                    // Sync callback throws.\r\n                    reject(e);\r\n                }\r\n            });\r\n        };\r\n        // Attach the onAbort if present\r\n        wrappedCallback.onAbort = onAbort;\r\n        this.queue.push(wrappedCallback);\r\n        var index = this.queue.length - 1;\r\n        return function () {\r\n            // Unsubscribe. Replace with no-op. Do not remove from array, or it will disturb\r\n            // indexing of other elements.\r\n            _this.queue[index] = function () { return Promise.resolve(); };\r\n        };\r\n    };\r\n    AuthMiddlewareQueue.prototype.runMiddleware = function (nextUser) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var onAbortStack, _i, _a, beforeStateCallback, e_1, _b, onAbortStack_1, onAbort;\r\n            return __generator(this, function (_c) {\r\n                switch (_c.label) {\r\n                    case 0:\r\n                        if (this.auth.currentUser === nextUser) {\r\n                            return [2 /*return*/];\r\n                        }\r\n                        onAbortStack = [];\r\n                        _c.label = 1;\r\n                    case 1:\r\n                        _c.trys.push([1, 6, , 7]);\r\n                        _i = 0, _a = this.queue;\r\n                        _c.label = 2;\r\n                    case 2:\r\n                        if (!(_i < _a.length)) return [3 /*break*/, 5];\r\n                        beforeStateCallback = _a[_i];\r\n                        return [4 /*yield*/, beforeStateCallback(nextUser)];\r\n                    case 3:\r\n                        _c.sent();\r\n                        // Only push the onAbort if the callback succeeds\r\n                        if (beforeStateCallback.onAbort) {\r\n                            onAbortStack.push(beforeStateCallback.onAbort);\r\n                        }\r\n                        _c.label = 4;\r\n                    case 4:\r\n                        _i++;\r\n                        return [3 /*break*/, 2];\r\n                    case 5: return [3 /*break*/, 7];\r\n                    case 6:\r\n                        e_1 = _c.sent();\r\n                        // Run all onAbort, with separate try/catch to ignore any errors and\r\n                        // continue\r\n                        onAbortStack.reverse();\r\n                        for (_b = 0, onAbortStack_1 = onAbortStack; _b < onAbortStack_1.length; _b++) {\r\n                            onAbort = onAbortStack_1[_b];\r\n                            try {\r\n                                onAbort();\r\n                            }\r\n                            catch (_) {\r\n                                /* swallow error */\r\n                            }\r\n                        }\r\n                        throw this.auth._errorFactory.create(\"login-blocked\" /* AuthErrorCode.LOGIN_BLOCKED */, {\r\n                            originalMessage: e_1 === null || e_1 === void 0 ? void 0 : e_1.message\r\n                        });\r\n                    case 7: return [2 /*return*/];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    return AuthMiddlewareQueue;\r\n}());\r\nexport { AuthMiddlewareQueue };\r\n//# sourceMappingURL=middleware.js.map","references":["/home/matt/Desktop/Projects/Freelance/Damon Chen/firebase-package/packages/auth/src/model/auth.ts","/home/matt/Desktop/Projects/Freelance/Damon Chen/firebase-package/packages/auth/src/model/public_types.ts","/home/matt/Desktop/Projects/Freelance/Damon Chen/firebase-package/packages/auth/src/core/errors.ts"],"map":"{\"version\":3,\"file\":\"middleware.js\",\"sourceRoot\":\"\",\"sources\":[\"../../../../../../../src/core/auth/middleware.ts\"],\"names\":[],\"mappings\":\"AAAA;;;;;;;;;;;;;;;GAeG;;AAWH;IAGE,6BAA6B,IAAkB;QAAlB,SAAI,GAAJ,IAAI,CAAc;QAF9B,UAAK,GAAsB,EAAE,CAAC;IAEG,CAAC;IAEnD,0CAAY,GAAZ,UACE,QAAqD,EACrD,OAAoB;QAFtB,iBA8BC;QA1BC,sDAAsD;QACtD,iCAAiC;QACjC,IAAM,eAAe,GAAoB,UACvC,IAAiB;YAEjB,OAAA,IAAI,OAAO,CAAC,UAAC,OAAO,EAAE,MAAM;gBAC1B,IAAI;oBACF,IAAM,MAAM,GAAG,QAAQ,CAAC,IAAI,CAAC,CAAC;oBAC9B,6DAA6D;oBAC7D,+BAA+B;oBAC/B,OAAO,CAAC,MAAM,CAAC,CAAC;iBACjB;gBAAC,OAAO,CAAC,EAAE;oBACV,wBAAwB;oBACxB,MAAM,CAAC,CAAC,CAAC,CAAC;iBACX;YACH,CAAC,CAAC;QAVF,CAUE,CAAC;QACL,gCAAgC;QAChC,eAAe,CAAC,OAAO,GAAG,OAAO,CAAC;QAClC,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,eAAe,CAAC,CAAC;QAEjC,IAAM,KAAK,GAAG,IAAI,CAAC,KAAK,CAAC,MAAM,GAAG,CAAC,CAAC;QACpC,OAAO;YACL,gFAAgF;YAChF,8BAA8B;YAC9B,KAAI,CAAC,KAAK,CAAC,KAAK,CAAC,GAAG,cAAM,OAAA,OAAO,CAAC,OAAO,EAAE,EAAjB,CAAiB,CAAC;QAC9C,CAAC,CAAC;IACJ,CAAC;IAEK,2CAAa,GAAnB,UAAoB,QAAqB;;;;;;wBACvC,IAAI,IAAI,CAAC,IAAI,CAAC,WAAW,KAAK,QAAQ,EAAE;4BACtC,sBAAO;yBACR;wBAKK,YAAY,GAAsB,EAAE,CAAC;;;;8BAEG,EAAV,KAAA,IAAI,CAAC,KAAK;;;6BAAV,CAAA,cAAU,CAAA;wBAAjC,mBAAmB;wBAC5B,qBAAM,mBAAmB,CAAC,QAAQ,CAAC,EAAA;;wBAAnC,SAAmC,CAAC;wBAEpC,iDAAiD;wBACjD,IAAI,mBAAmB,CAAC,OAAO,EAAE;4BAC/B,YAAY,CAAC,IAAI,CAAC,mBAAmB,CAAC,OAAO,CAAC,CAAC;yBAChD;;;wBAN+B,IAAU,CAAA;;;;;wBAS5C,oEAAoE;wBACpE,WAAW;wBACX,YAAY,CAAC,OAAO,EAAE,CAAC;wBACvB,WAAkC,EAAZ,6BAAY,EAAZ,0BAAY,EAAZ,IAAY,EAAE;4BAAzB,OAAO;4BAChB,IAAI;gCACF,OAAO,EAAE,CAAC;6BACX;4BAAC,OAAO,CAAC,EAAE;gCACV,mBAAmB;6BACpB;yBACF;wBAED,MAAM,IAAI,CAAC,IAAI,CAAC,aAAa,CAAC,MAAM,oDAA8B;4BAChE,eAAe,EAAG,GAAW,aAAX,GAAC,uBAAD,GAAC,CAAY,OAAO;yBACvC,CAAC,CAAC;;;;;KAEN;IACH,0BAAC;AAAD,CAAC,AAxED,IAwEC\"}","dts":{"name":"/home/matt/Desktop/Projects/Freelance/Damon Chen/firebase-package/packages/auth/node_modules/.cache/rollup-plugin-typescript2/placeholder/src/core/auth/middleware.d.ts","writeByteOrderMark":false,"text":"/**\r\n * @license\r\n * Copyright 2022 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nimport { AuthInternal } from '../../model/auth';\r\nimport { Unsubscribe, User } from '../../model/public_types';\r\nexport declare class AuthMiddlewareQueue {\r\n    private readonly auth;\r\n    private readonly queue;\r\n    constructor(auth: AuthInternal);\r\n    pushCallback(callback: (user: User | null) => void | Promise<void>, onAbort?: () => void): Unsubscribe;\r\n    runMiddleware(nextUser: User | null): Promise<void>;\r\n}\r\n"}}
